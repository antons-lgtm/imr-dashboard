<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>IMR Regional IV</title>
<style>
html,body{
  margin:0;padding:0;height:100%;
  font-family:Arial,sans-serif;overflow:hidden;
}
body{display:flex;background:#f5f5f5;}

/* Sidebar kiri */
header{
  position:fixed;
  top:0;left:0;
  width:70px;
  height:100%;
  background:#66C5CC; /* warna senada dashboard */
  color:rgba(255,255,255,0.9);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  box-shadow:2px 0 6px rgba(0,0,0,0.2);
  z-index:10;
}

header h1{
  writing-mode: vertical-rl;
  transform: rotate(180deg);
  font-size:0.9rem;
  margin:0;
  letter-spacing:2px;
  text-align:center;
  font-weight:600;
  user-select:none;
}

/* Kontainer utama */
.main-container{
  margin-left:70px;
  flex:1;
  position:relative;
}

/* Login */
.login-container,.iframe-container{
  position:absolute;
  top:0;left:0;width:100%;height:100%;
  transition:height .2s;
}
.login-container{
  display:flex;align-items:center;justify-content:center;
  flex-direction:column;gap:12px;
  background:#f4f6f8;
}
.login-container input{
  padding:10px;width:220px;border:1px solid #ccc;border-radius:4px;
}
.login-container button{
  padding:10px 18px;
  background:#66C5CC;color:#fff;
  border:0;border-radius:6px;cursor:pointer;
  transition:0.2s;
}
.login-container button:hover{background:#57b2b9;}
#loginInfo{color:#b00;display:none;margin-top:8px}

/* Iframe */
.iframe-container{display:none;background:#fff;}
iframe{width:100%;height:100%;border:0;}

/* Tombol refresh */
.refresh-btn{
  position:fixed;
  bottom:70px;
  left:18px;
  z-index:30;
  background:#ffffffcc;
  border:0;
  border-radius:50%;
  width:38px;height:38px;
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 2px 6px rgba(0,0,0,0.25);
  cursor:pointer;
  transition:0.2s;
}
.refresh-btn:hover{background:#e7f6f7;transform:scale(1.05);}

/* Header kanan atas */
.top-header{
  position:fixed;
  top:10px;
  right:20px;
  font-size:14px;
  font-weight:500;
  color:#333;
  background:rgba(255,255,255,0.7);
  padding:6px 12px;
  border-radius:8px;
  backdrop-filter:blur(4px);
  z-index:40;
}
</style>
</head>
<body>

<header>
  <h1>INTEGRATED MANAGEMENT REPORT</h1>
</header>

<div class="main-container">
  <div class="login-container" id="loginContainer">
    <input id="username" placeholder="Username" autocomplete="username" />
    <input id="password" type="password" placeholder="Password" autocomplete="current-password" />
    <button id="loginBtn">Login</button>
    <div id="loginInfo"></div>
  </div>

  <div class="iframe-container" id="iframeContainer">
    <iframe id="reportFrame" 
      src="https://lookerstudio.google.com/embed/reporting/dc7cc293-f66b-4592-b2de-baa279dfbdd9/page/p_fs550p1ywd" 
      allowfullscreen 
      sandbox="allow-scripts allow-same-origin allow-popups"></iframe>
  </div>
</div>

<button class="refresh-btn" id="refreshBtn" title="Refresh">ðŸ”„</button>
<div class="top-header">Halo, Admin ðŸ‘‹</div>

<script>
const loginBtn=document.getElementById('loginBtn');
const usernameEl=document.getElementById('username');
const passwordEl=document.getElementById('password');
const loginContainer=document.getElementById('loginContainer');
const iframeContainer=document.getElementById('iframeContainer');
const reportFrame=document.getElementById('reportFrame');
const loginInfo=document.getElementById('loginInfo');

function isLoggedIn(){return localStorage.getItem('imr_logged')==='1';}

if(isLoggedIn()){
  loginContainer.style.display='none';
  iframeContainer.style.display='block';
}

loginBtn.addEventListener('click',async()=>{
  loginInfo.style.display='none';
  const username=usernameEl.value.trim();
  const password=passwordEl.value;
  if(!username||!password){
    loginInfo.textContent='Masukkan username & password';
    loginInfo.style.display='block';
    return;
  }
  try{
    const res=await fetch('/.netlify/functions/auth',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({username,password})
    });
    const data=await res.json();
    if(res.ok&&data.ok){
      localStorage.setItem('imr_logged','1');
      loginContainer.style.display='none';
      iframeContainer.style.display='block';
    }else{
      loginInfo.textContent=data.msg||'Login gagal';
      loginInfo.style.display='block';
    }
  }catch(err){
    console.error(err);
    loginInfo.textContent='Terjadi kesalahan koneksi';
    loginInfo.style.display='block';
  }
});

document.getElementById('refreshBtn').addEventListener('click',()=>{ reportFrame.src=reportFrame.src; });
setInterval(()=>{ reportFrame.src=reportFrame.src; },10*60*1000);
</script>

</body>
</html>
