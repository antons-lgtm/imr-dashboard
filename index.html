<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>IMR Regional IV (Sidebar)</title>
<style>
html,body{margin:0;padding:0;height:100%;font-family:Arial,sans-serif;overflow:hidden}
body{display:flex}

/* Sidebar kiri */
header{
  position:fixed;
  top:0;left:0;
  width:70px;
  height:100%;
  background:#004aad;
  color:#fff;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding-top:15px;
  box-shadow:2px 0 6px rgba(0,0,0,0.2);
  z-index:10;
}

/* Judul/ikon di sidebar */
header h1{
  writing-mode: vertical-rl;
  transform: rotate(180deg);
  font-size:1rem;
  margin:0;
  text-align:center;
}

/* Kontainer login & iframe */
.main-container{
  margin-left:70px;
  flex:1;
  position:relative;
}

/* Login */
.login-container,.iframe-container{
  position:absolute;
  top:0;left:0;width:100%;height:100%;transition:height .2s;
}
.login-container{display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px;background:#f4f6f8}
.login-container input{padding:10px;width:220px}
.login-container button{padding:10px 18px;background:#004aad;color:#fff;border:0;border-radius:6px;cursor:pointer}
#loginInfo{color:#b00;display:none;margin-top:8px}

/* Iframe */
.iframe-container{display:none;background:#fff}
iframe{width:100%;height:100%;border:0}

/* Tombol floating (refresh) */
.floating-buttons{position:fixed;top:10px;left:10px;z-index:30}
.btn-icon{background:#ffffffcc;border:0;border-radius:50%;width:42px;height:42px;display:flex;align-items:center;justify-content:center;cursor:pointer}
</style>
</head>
<body>

<header>
  <h1>IMR</h1>
  <div class="floating-buttons">
    <button id="refreshBtn" class="btn-icon" title="Refresh">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 .34-.03.67-.08 1h2.02c.04-.33.06-.66.06-1 0-4.42-3.58-8-8-8zm-6 7c0-.34.03-.67.08-1H4.06C4.02 10.33 4 10.66 4 11c0 4.42 3.58 8 8 8v3l4-4-4-4v3c-3.31 0-6-2.69-6-6z"/></svg>
    </button>
  </div>
</header>

<div class="main-container">
  <div class="login-container" id="loginContainer">
    <input id="username" placeholder="Username" autocomplete="username" />
    <input id="password" type="password" placeholder="Password" autocomplete="current-password" />
    <button id="loginBtn">Login</button>
    <div id="loginInfo"></div>
  </div>

  <div class="iframe-container" id="iframeContainer">
    <iframe id="reportFrame" src="https://lookerstudio.google.com/embed/reporting/dc7cc293-f66b-4592-b2de-baa279dfbdd9/page/p_fs550p1ywd" allowfullscreen sandbox="allow-scripts allow-same-origin allow-popups"></iframe>
  </div>
</div>

<script>
const loginBtn=document.getElementById('loginBtn');
const usernameEl=document.getElementById('username');
const passwordEl=document.getElementById('password');
const loginContainer=document.getElementById('loginContainer');
const iframeContainer=document.getElementById('iframeContainer');
const reportFrame=document.getElementById('reportFrame');
const loginInfo=document.getElementById('loginInfo');

function isLoggedIn(){return localStorage.getItem('imr_logged')==='1';}

if(isLoggedIn()){ loginContainer.style.display='none'; iframeContainer.style.display='block'; }

loginBtn.addEventListener('click',async()=>{
  loginInfo.style.display='none';
  const username=usernameEl.value.trim();
  const password=passwordEl.value;
  if(!username||!password){ loginInfo.textContent='Masukkan username & password'; loginInfo.style.display='block'; return; }
  try{
    const res=await fetch('/.netlify/functions/auth',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});
    const data=await res.json();
    if(res.ok&&data.ok){ localStorage.setItem('imr_logged','1'); loginContainer.style.display='none'; iframeContainer.style.display='block'; }
    else{ loginInfo.textContent=data.msg||'Login gagal'; loginInfo.style.display='block'; }
  }catch(err){ console.error(err); loginInfo.textContent='Terjadi kesalahan koneksi'; loginInfo.style.display='block'; }
});

document.getElementById('refreshBtn').addEventListener('click',()=>{ reportFrame.src=reportFrame.src; });
setInterval(()=>{ reportFrame.src=reportFrame.src; },10*60*1000);
</script>
</body>
</html>
